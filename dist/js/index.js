var loadAndFetchSpine={init:function(){this.spineItem,this.spineInfoArr=[],$('<div id="loading"></div>').prependTo($("section"));for(var e=0;e<7;e++)$('<div class="loadItem"></div>').prependTo($("section").find("#loading"));this.loadingAndBanner(),this.fetchSpineInfo(),this.showAllSpine(),this.downLoadSpine()},loadingAndBanner:function(){var e=$(".swiper-container.banner");TweenMax.to(e,1,{opacity:1,ease:Strong.easeOut,onComplete:function(){new Swiper($(".swiper-container.banner"),{autoplay:3500,loop:!0})}});var i=$("section").find(" #loading .loadItem");TweenMax.staggerTo(i,.2,{scaleY:1.6,repeat:-1,yoyo:!0,ease:Linear.easeInOut},.1)},loadedAnimate:function(){this.LoadTimeOut=setTimeout(function(){var e=$("#loading");TweenMax.to(e,1,{opacity:0,ease:Strong.easeOut,onComplete:function(){e.remove()}})},400)},fetchSpineInfo:function(){var e=this;$.ajax({type:"GET",async:!0,url:"https://mapi.magic-store.cn/mstore/spine/tree/details",success:function(i){if(console.log(i),200==i.code){e.spineItem=i.entities;try{window.MStore.spineDomains(i.pkgBucket,i.imgBucket,i.endpoint)}catch(e){console.log(e.message)}e.item=i.entities,e.imgBucket=i.imgBucket,e.endpoint=i.endpoint,e.createSpineItems(i.entities,i.imgBucket,i.endpoint)}}})},spineLoadedList:function(e){console.log(e),this.spineInfoArr=JSON.parse(e)},createSpineItems:function(e,i,n){for(var s=0;s<e.length;s++){var t=$('<div class="classify swiper-container"></div>');t.attr("data-categoryid",e[s].id);var a="<p><i>"+e[s].name+'</i><span class="showAll">显示全部</span></p> <div class="swiper-wrapper">',o=5;e[s].spines.length<=o&&(o=e[s].spines.length);for(var r=0;r<o;r++){a+='<div class="swiper-slide" data-source="'+e[s].spines[r].source+'" data-id="'+e[s].spines[r].id+'"><img class="border" src="img/MS_icon_asset_02.png"  alt="" /><img class="magic" src="http://'+i+"."+n+"/"+e[s].spines[r].cover+'" />';try{for(var c=0;c<this.spineInfoArr.length;c++){var d='<span class="download"></span></div>';if(e[s].spines[r].id==this.spineInfoArr[c].jsonContent.id){d="</div>";break}}if(0==this.spineInfoArr.length)var d='<span class="download"></span></div>'}catch(e){console.log(e.message)}a+=d}a+="</div>",t.html(a),$("section").append(t)}this.loadedAnimate();var l=$("section .classify");TweenMax.staggerTo(l,1,{opacity:1,ease:Linear.easeInOut},.3);var p=$("section .swiper-slide");TweenMax.staggerFrom(p,1.5,{scale:.7,opacity:0,ease:Elastic.easeOut},.1);var f=$("section .classify").find(".magic");TweenMax.staggerFrom(f,2,{scale:2,opacity:0,ease:Strong.easeOut},.1)},showAllSpine:function(){var e=this;$("section").on("click",".classify .showAll",function(){window.location="list.html";var i=$(this).parents(".classify").index(),n={itemId:e.spineItem[i].id,itemName:e.spineItem[i].name};localStorage.setItem("itemInfo",JSON.stringify(n))})},downLoadSpine:function(){var e=this;$("section").on("click",".classify .swiper-slide",function(){var i=$(this).find(".download");i.addClass("loading"),TweenMax.to(i,.9,{rotation:360,ease:Linear.easeOut,repeat:-1});var n=$(this).parents(".classify").index(),s=$(this).index();window.MStore.spineWillDownload($(this).data("source"),JSON.stringify(e.spineItem[n].spines[s]))})},spineDidDownload:function(e,i){if(console.log("spineDidDownload"),e&&i){var n=$('section .swiper-container .swiper-slide[data-source="'+e+'"]'),s=n.find(".download");setTimeout(function(){TweenMax.to(s,.3,{scale:2,opacity:0,ease:Strong.easeOut,onComplete:function(){s.hide()}})},500)}}};loadAndFetchSpine.init();